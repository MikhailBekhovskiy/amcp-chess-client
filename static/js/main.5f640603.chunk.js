(this["webpackJsonpamcp-chess-client"]=this["webpackJsonpamcp-chess-client"]||[]).push([[0],{183:function(e,t,a){e.exports=a(664)},581:function(e,t,a){},588:function(e,t,a){},589:function(e,t,a){},620:function(e,t,a){},621:function(e,t,a){},622:function(e,t,a){},623:function(e,t,a){},624:function(e,t,a){},625:function(e,t,a){},626:function(e,t,a){},664:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(47),c=a.n(r),o=a(36),i=a(14),l=(a(581),a(11)),u=a.n(l),m=a(13),d=a(37),p=a(673),h=a(671),g=a(672),v=a(44),b=(a(588),a(101)),f=a(665),E=a(666);a(589);function S(e){var t=Object(n.useState)([]),a=Object(m.a)(t,2),r=a[0],c=a[1],o=Object(n.useState)(!0),l=Object(m.a)(o,2),d=l[0],p=l[1];return Object(n.useEffect)((function(){!function(){var t;u.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(e.isAuthenticated){a.next=2;break}return a.abrupt("return");case 2:return a.prev=2,a.next=5,u.a.awrap(i.a.get("chess","/games"));case 5:t=a.sent,c(t),a.next=12;break;case 9:a.prev=9,a.t0=a.catch(2),alert(a.t0);case 12:p(!1);case 13:case"end":return a.stop()}}),null,null,[[2,9]])}()}),[e.isAuthenticated]),s.a.createElement("div",{className:"Home"},e.isAuthenticated?s.a.createElement("div",{className:"games"},s.a.createElement(f.a,null,"Games"),s.a.createElement(E.a,null,!d&&function(e){return[{}].concat(e).map((function(e,t){return 0!==t?s.a.createElement(v.LinkContainer,{key:e.gameId,to:"/games/".concat(e.gameId)},s.a.createElement(b.a,{header:e.gameId.trim().split("\n")[0]},"Created: "+new Date(e.createdAt).toLocaleString())):s.a.createElement(v.LinkContainer,{key:"new",to:"/games/new"},s.a.createElement(b.a,null,s.a.createElement("h4",null,s.a.createElement("b",null,"\uff0b")," Create a new game")))}))}(r))):s.a.createElement("div",{className:"lander"},s.a.createElement("h1",null,"Scratch"),s.a.createElement("p",null,"A sample for the future of online gaming!")))}a(620);function O(){return s.a.createElement("div",{className:"NotFound"},s.a.createElement("h3",null,"Sorry, page not found!"))}var y=a(43);function k(e){var t=e.component,a=e.appProps,n=Object(y.a)(e,["component","appProps"]);return s.a.createElement(d.d,Object.assign({},n,{render:function(e){return s.a.createElement(t,Object.assign({},e,a))}}))}var w=a(668),j=a(669),x=a(674),I=a(667),C=a(171);a(621);function L(e){var t=e.isLoading,a=e.className,n=void 0===a?"":a,r=e.disabled,c=void 0!==r&&r,o=Object(y.a)(e,["isLoading","className","disabled"]);return s.a.createElement(I.a,Object.assign({className:"LoaderButton ".concat(n),disabled:c||t},o),t&&s.a.createElement(C.a,{glyph:"refresh",className:"spinning"}),o.children)}var P=a(74),N=a(172);function M(e){var t=Object(n.useState)(e),a=Object(m.a)(t,2),s=a[0],r=a[1];return[s,function(e){r(Object(N.a)({},s,Object(P.a)({},e.target.id,e.target.value)))}]}a(622);function T(e){var t=Object(n.useState)(!1),a=Object(m.a)(t,2),r=a[0],c=a[1],o=M({email:"",password:""}),l=Object(m.a)(o,2),d=l[0],p=l[1];return s.a.createElement("div",{className:"Login"},s.a.createElement("form",{onSubmit:function(t){return u.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t.preventDefault(),c(!0),a.prev=2,a.next=5,u.a.awrap(i.b.signIn(d.email,d.password));case 5:e.userHasAuthenticated(!0),a.next=12;break;case 8:a.prev=8,a.t0=a.catch(2),alert(a.t0.message),c(!1);case 12:case"end":return a.stop()}}),null,null,[[2,8]])}},s.a.createElement(w.a,{controlId:"email",bsSize:"large"},s.a.createElement(j.a,null,"Email"),s.a.createElement(x.a,{autoFocus:!0,type:"email",value:d.email,onChange:p})),s.a.createElement(w.a,{controlId:"password",bsSize:"large"},s.a.createElement(j.a,null,"Password"),s.a.createElement(x.a,{type:"password",value:d.password,onChange:p})),s.a.createElement(L,{block:!0,type:"submit",bsSize:"large",isLoading:r,disabled:!(d.email.length>0&&d.password.length>0)},"Login")))}var A=a(670);a(623);function W(e){var t=M({email:"",password:"",confirmPassword:"",confirmationCode:""}),a=Object(m.a)(t,2),r=a[0],c=a[1],o=Object(n.useState)(null),l=Object(m.a)(o,2),d=l[0],p=l[1],h=Object(n.useState)(!1),g=Object(m.a)(h,2),v=g[0],b=g[1];function f(e){var t;return u.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return e.preventDefault(),b(!0),a.prev=2,a.next=5,u.a.awrap(i.b.signUp({username:r.email,password:r.password}));case 5:t=a.sent,i.a.post("chess","/signup"),b(!1),p(t),a.next=15;break;case 11:a.prev=11,a.t0=a.catch(2),alert(a.t0.message),b(!1);case 15:case"end":return a.stop()}}),null,null,[[2,11]])}function E(t){return u.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t.preventDefault(),b(!0),a.prev=2,a.next=5,u.a.awrap(i.b.confirmSignUp(r.email,r.confirmationCode));case 5:return a.next=7,u.a.awrap(i.b.signIn(r.email,r.password));case 7:e.userHasAuthenticated(!0),e.history.push("/"),a.next=15;break;case 11:a.prev=11,a.t0=a.catch(2),alert(a.t0.message),b(!1);case 15:case"end":return a.stop()}}),null,null,[[2,11]])}return s.a.createElement("div",{className:"Signup"},null===d?s.a.createElement("form",{onSubmit:f},s.a.createElement(w.a,{controlId:"email",bsSize:"large"},s.a.createElement(j.a,null,"Email"),s.a.createElement(x.a,{autoFocus:!0,type:"email",value:r.email,onChange:c})),s.a.createElement(w.a,{controlId:"password",bsSize:"large"},s.a.createElement(j.a,null,"Password"),s.a.createElement(x.a,{type:"password",value:r.password,onChange:c})),s.a.createElement(w.a,{controlId:"confirmPassword",bsSize:"large"},s.a.createElement(j.a,null,"Confirm Password"),s.a.createElement(x.a,{type:"password",onChange:c,value:r.confirmPassword})),s.a.createElement(L,{block:!0,type:"submit",bsSize:"large",isLoading:v,disabled:!(r.email.length>0&&r.password.length>0&&r.password===r.confirmPassword)},"Signup")):s.a.createElement("form",{onSubmit:E},s.a.createElement(w.a,{controlId:"confirmationCode",bsSize:"large"},s.a.createElement(j.a,null,"Confirmation Code"),s.a.createElement(x.a,{autoFocus:!0,type:"tel",onChange:c,value:r.confirmationCode}),s.a.createElement(A.a,null,"Please check your email for the code.")),s.a.createElement(L,{block:!0,type:"submit",bsSize:"large",isLoading:v,disabled:!(r.confirmationCode.length>0)},"Verify")))}a(624);function F(e){var t=Object(n.useState)(!1),a=Object(m.a)(t,2),r=a[0],c=a[1],o=M({roomType:""}),l=Object(m.a)(o,2),d=l[0],p=l[1];function h(e){return i.a.post("chess","/games",{body:e})}return s.a.createElement("div",{className:"NewGame"},s.a.createElement("form",{onSubmit:function(t){var a,n;return u.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:return t.preventDefault(),c(!0),s.prev=2,a={roomType:d.roomType.length>0?d.roomType:"open"},s.next=6,u.a.awrap(h(a));case 6:n=s.sent,e.history.push("/games/"+n.gameId),s.next=14;break;case 10:s.prev=10,s.t0=s.catch(2),alert(s.t0.message),c(!1);case 14:case"end":return s.stop()}}),null,null,[[2,10]])}},s.a.createElement(w.a,{controlId:"roomType",bsSize:"large"},s.a.createElement(j.a,null,"Open or hidden"),s.a.createElement(x.a,{autoFocus:!0,type:"textarea",value:d.roomType,onChange:p})),s.a.createElement(L,{block:!0,type:"submit",bsSize:"large",isLoading:r,disabled:!("hidden"===d.roomType||"open"===d.roomType||""===d.roomType)},"Create")))}var D=a(173),z=a(174),G=a(179),_=a(175),H=a(24),R=a(180),B=a(178),J=(a(625),{REGION:"eu-central-1",URL:"https://qh07nhidve.execute-api.eu-central-1.amazonaws.com/dev",WS:"wss://07lk2rj3i7.execute-api.eu-central-1.amazonaws.com/dev"}),U={REGION:"eu-central-1",USER_POOL_ID:"eu-central-1_sCMpoCFo2",APP_CLIENT_ID:"3khsh883ngocv1c1kpklgmrk1f",IDENTITY_POOL_ID:"eu-central-1:da8ff3f9-8814-4dee-8128-6c26de954437"};a(626);function Y(e){return s.a.createElement("div",{className:"Chat"},s.a.createElement($,{messages:e.messages}),s.a.createElement("form",{onSubmit:e.handleSubmit},s.a.createElement(w.a,{controlId:"text"},s.a.createElement(x.a,{value:e.text,componentClass:"textarea",onChange:e.textOnChange,style:{overflow:"hidden"}})),s.a.createElement(L,{block:!0,type:"submit",bsSize:"large",bsStyle:"primary",isLoading:e.isLoading,disabled:e.disabled},"Send")))}function $(e){return s.a.createElement("div",{className:"MessagesContainer"},e.messages.map((function(e,t){return s.a.createElement(q,{key:"message-"+t,message:e})})))}function q(e){return s.a.createElement("div",{className:"ChatMessage"},s.a.createElement("div",{className:"body"},s.a.createElement("div",{className:"text"},e.message)))}var V=a(103),K=a.n(V),Q=a(176),X=a.n(Q);function Z(e){var t=[],a=e.split(" ")[0].split("/"),n=0;return a.forEach((function(e,a){n=0,Object(B.a)(e).forEach((function(e,s){if(e>="0"&&e<="8")n+=parseInt(e)-1;else{var r=String.fromCharCode(s+97+n)+(8-a).toString();t.push(e+"@"+r)}}))})),t}var ee=function(e){function t(e){var a;return Object(D.a)(this,t),e.userHasJoinedGame(!0),(a=Object(G.a)(this,Object(_.a)(t).call(this,e))).state={isLoading:!1,text:"",move:"",moves:[],messages:[],socket:null,chess:null,pieces:[]},a.connectToWebSocket=a.connectToWebSocket.bind(Object(H.a)(a)),a.validateMessageForm=a.validateMessageForm.bind(Object(H.a)(a)),a.validateMoveForm=a.validateMoveForm.bind(Object(H.a)(a)),a.sendToWebsocket=a.sendToWebsocket.bind(Object(H.a)(a)),a.sendMessage=a.sendMessage.bind(Object(H.a)(a)),a.sendInfo=a.sendInfo.bind(Object(H.a)(a)),a.disconnect=a.disconnect.bind(Object(H.a)(a)),a.leaveGame=a.leaveGame.bind(Object(H.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(H.a)(a)),a.submitSend=a.submitSend.bind(Object(H.a)(a)),a.sendMove=a.sendMove.bind(Object(H.a)(a)),a.onMovePiece=a.onMovePiece.bind(Object(H.a)(a)),a}return Object(R.a)(t,e),Object(z.a)(t,[{key:"componentDidMount",value:function(){this.connectToWebSocket(),this.sendInfo()}},{key:"connectToWebSocket",value:function(){var e=this,t=new WebSocket(J.WS);t.onmessage=function(t){var a=JSON.parse(t.data);switch(console.log("New message:",t),a.action){case"sendMessage":e.setState((function(e,t){return{messages:e.messages.concat(a.message)}}));break;case"gameOver":case"move":e.setState((function(e,t){return{moves:e.moves.concat(a.move)}}));var n=e.state.chess;n.move(a.move,{sloppy:!0}),e.setState({chess:n,pieces:Z(n.fen())});break;case"gameStarted":e.setState({chess:new X.a});break;default:e.setState((function(e,t){return{messages:e.messages.concat("Unknown socket message:",JSON.stringify(a))}}))}},t.onerror=function(e){console.error("WebSocket error observed:",e)},this.setState({socket:t})}},{key:"validateMessageForm",value:function(){return this.state.text.length>0}},{key:"validateMoveForm",value:function(){return this.state.move.length>0}},{key:"sendToWebsocket",value:function(e){var t=this;return u.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:this.state.socket.readyState?(this.state.socket.send(JSON.stringify(e)),this.setState({isLoading:!1})):(this.setState({isLoading:!0}),setTimeout((function(){t.sendToWebsocket(e)}),100));case 1:case"end":return a.stop()}}),null,this)}},{key:"sendMessage",value:function(){var e={action:"propagateMessage",message:this.state.text,gameId:"".concat(this.props.match.params.id)};this.sendToWebsocket(e)}},{key:"sendInfo",value:function(){var e,t=this;return u.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(this.state.socket){a.next=5;break}this.setState({isLoading:!0}),setTimeout((function(){t.sendInfo()}),100),a.next=11;break;case 5:return e={action:"send-gameid",gameId:"".concat(this.props.match.params.id)},a.next=8,u.a.awrap(this.sendToWebsocket(e));case 8:return a.next=10,u.a.awrap(i.a.post("chess","/games/".concat(this.props.match.params.id),{body:{gameId:"".concat(this.props.match.params.id)}}));case 10:this.setState({isLoading:!1});case 11:case"end":return a.stop()}}),null,this)}},{key:"disconnect",value:function(){return u.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.a.awrap(i.a.del("chess","/games/".concat(this.props.match.params.id),{body:{gameId:"".concat(this.props.match.params.id)}}));case 2:this.state.socket&&this.state.socket.close();case 3:case"end":return e.stop()}}),null,this)}},{key:"leaveGame",value:function(){return u.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.a.awrap(this.disconnect());case 2:return this.props.userHasJoinedGame(!1),e.abrupt("return",!0);case 4:case"end":return e.stop()}}),null,this)}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.sendMessage()}},{key:"submitSend",value:function(e){e.preventDefault(),this.sendMove(this.state.move)}},{key:"sendMove",value:function(e){var t={action:"makeMove",move:e,gameId:"".concat(this.props.match.params.id)};this.sendToWebsocket(t)}},{key:"onMovePiece",value:function(e,t,a){console.log(t,a);var n=this.state.chess;n.move(t+a,{sloppy:!0})&&this.sendMove(t+a),this.setState({chess:n})}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"Game"},s.a.createElement(d.b,{when:!0,message:this.leaveGame}),s.a.createElement("div",{className:"BoardWrapper"},s.a.createElement(K.a,{pieces:this.state.chess?Z(this.state.chess.fen()):K.a.getDefaultLineup(),onMovePiece:this.onMovePiece})),s.a.createElement("div",{className:"Forms"},s.a.createElement(Y,{messages:this.state.messages,handleSubmit:this.handleSubmit,text:this.state.text,textOnChange:function(t){return e.setState({text:t.target.value})},isLoading:this.state.isLoading,disabled:!this.validateMessageForm()}),s.a.createElement("div",{className:"Moves"},s.a.createElement("form",{onSubmit:this.submitSend},s.a.createElement(w.a,{controlId:"content"},s.a.createElement(x.a,{value:this.state.move,componentClass:"textarea",onChange:function(t){return e.setState({move:t.target.value})}})),s.a.createElement(L,{block:!0,type:"submit",bsSize:"large",bsStyle:"primary",isLoading:this.state.isLoading,disabled:!this.validateMoveForm()},"SendMove")),s.a.createElement("div",null,this.state.moves))))}}]),t}(s.a.Component),te=a(55),ae=a.n(te);function ne(e){var t=Object(n.useState)([]),a=Object(m.a)(t,2),r=a[0],c=a[1],o=Object(n.useState)(!0),l=Object(m.a)(o,2),d=l[0],p=l[1];return Object(n.useEffect)((function(){!function(){var t;u.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(e.isAuthenticated){a.next=2;break}return a.abrupt("return");case 2:return a.prev=2,a.next=5,u.a.awrap(i.a.get("chess","/profile/parties"));case 5:t=a.sent,console.log("parties:",t),c(t),a.next=13;break;case 10:a.prev=10,a.t0=a.catch(2),alert(a.t0);case 13:p(!1);case 14:case"end":return a.stop()}}),null,null,[[2,10]])}()}),[e.isAuthenticated]),s.a.createElement("div",{className:"Home"},e.isAuthenticated?s.a.createElement("div",{className:"parties"},s.a.createElement(f.a,null,"Your Parties"),s.a.createElement(E.a,null,!d&&function(e){function t(e){var t=Object(n.useState)(!1),a=Object(m.a)(t,2),r=a[0],c=a[1],o=function(){return c(!1)},i=e.party;return s.a.createElement(s.a.Fragment,null,s.a.createElement(I.a,{onClick:function(){return c(!0)}},s.a.createElement(b.a,{header:i.gameId},"Created: "+new Date(i.createdAt).toLocaleString()+"|"+i.user1Id+"|"+i.user2Id+"|"+i.winner)),s.a.createElement(ae.a,{show:r,onHide:o,animation:!1},s.a.createElement(ae.a.Header,{closeButton:!0},s.a.createElement(ae.a.Title,null,"Modal heading")),s.a.createElement(ae.a.Body,null,"Woohoo, you're reading this text in a modal!"),s.a.createElement(ae.a.Footer,null,s.a.createElement(I.a,{variant:"secondary",onClick:o},"Close"),s.a.createElement(I.a,{variant:"primary",onClick:o},"Save Changes"))))}return[].concat(e).map((function(e,a){return s.a.createElement(t,{party:e,key:e.createdAt})}))}(r))):s.a.createElement("div",{className:"lander"},s.a.createElement("p",null,"Here are your parties!")))}function se(e){var t=e.component,a=e.appProps,n=Object(y.a)(e,["component","appProps"]);return s.a.createElement(d.d,Object.assign({},n,{render:function(e){return a.isAuthenticated?s.a.createElement(t,Object.assign({},e,a)):s.a.createElement(d.c,{to:"/login?redirect=".concat(e.location.pathname).concat(e.location.search)})}}))}function re(e){var t=e.component,a=e.appProps,n=Object(y.a)(e,["component","appProps"]),r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location.href;e=e.replace(/[[]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)","i").exec(t);if(!a)return null;if(!a[2])return"";return decodeURIComponent(a[2].replace(/\+/g," "))}("redirect");return s.a.createElement(d.d,Object.assign({},n,{render:function(e){return a.isAuthenticated?s.a.createElement(d.c,{to:""===r||null===r?"/":r}):s.a.createElement(t,Object.assign({},e,a))}}))}function ce(e){var t=e.appProps;return s.a.createElement(d.g,null,s.a.createElement(k,{path:"/",exact:!0,component:S,appProps:t}),s.a.createElement(re,{path:"/login",exact:!0,component:T,appProps:t}),s.a.createElement(re,{path:"/signup",exact:!0,component:W,appProps:t}),s.a.createElement(se,{path:"/games/new",exact:!0,component:F,appProps:t}),s.a.createElement(se,{path:"/games/:id",exact:!0,component:ee,appProps:t}),s.a.createElement(se,{path:"/profile",exact:!0,component:ne,appProps:t}),s.a.createElement(d.d,{component:O}))}var oe=Object(d.k)((function(e){var t=Object(n.useState)(!0),a=Object(m.a)(t,2),r=a[0],c=a[1],l=Object(n.useState)(!1),d=Object(m.a)(l,2),b=d[0],f=d[1],E=Object(n.useState)(!1),S=Object(m.a)(E,2),O=S[0],y=S[1];return Object(n.useEffect)((function(){u.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.a.awrap(i.b.currentSession());case 3:f(!0),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),"No current user"!==e.t0&&alert(e.t0);case 9:c(!1);case 10:case"end":return e.stop()}}),null,null,[[0,6]])}),[]),!r&&s.a.createElement("div",{className:"App container"},s.a.createElement(p.a,{fluid:!0,collapseOnSelect:!0},s.a.createElement(p.a.Header,null,s.a.createElement(p.a.Brand,null,s.a.createElement(o.Link,{to:"/"},"Scratch")),s.a.createElement(p.a.Toggle,null)),s.a.createElement(p.a.Collapse,null,s.a.createElement(h.a,{pullRight:!0},b?O?s.a.createElement(v.LinkContainer,{to:"/"},s.a.createElement(g.a,null,"Leave")):s.a.createElement(s.a.Fragment,null,s.a.createElement(v.LinkContainer,{to:"/games/new"},s.a.createElement(g.a,null,"Create a game")),s.a.createElement(g.a,{onClick:function(){return u.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.a.awrap(i.b.signOut());case 2:f(!1),y(!1),e.history.push("/login");case 5:case"end":return t.stop()}}))}},"Logout")):s.a.createElement(s.a.Fragment,null,s.a.createElement(v.LinkContainer,{to:"/signup"},s.a.createElement(g.a,null,"Signup")),s.a.createElement(v.LinkContainer,{to:"/login"},s.a.createElement(g.a,null,"Login")))))),s.a.createElement(ce,{appProps:{isAuthenticated:b,userHasAuthenticated:f,inGame:O,userHasJoinedGame:y}}))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.c.configure({Auth:{mandatorySignIn:!0,region:U.REGION,userPoolId:U.USER_POOL_ID,identityPoolId:U.IDENTITY_POOL_ID,userPoolWebClientId:U.APP_CLIENT_ID},API:{endpoints:[{name:"chess",endpoint:J.URL,region:J.REGION}]}}),c.a.render(s.a.createElement(o.BrowserRouter,null,s.a.createElement(oe,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},81:function(e,t){}},[[183,1,2]]]);
//# sourceMappingURL=main.5f640603.chunk.js.map